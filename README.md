# ShopStyleSearch(SSS)

## 실행방법
```
docker-compose up -d --build
```
## 요약
- docker에서 쿠버네티스까지의 개념 이해를 위해 실제 개발 예시를 개발하여 테스트용으로 만들고자함.
- Shopstyle API 를 이용하여 상품을 조회하고, 조회시에는 Redis, 데이터저장에는 MongoDB, 서버는 python 으로 구축을함. 

### 배경
- MSA 에 대해서 구조를 이해하기 위해서 입니다, 특별한 배경은 없습니다

### 목표
- Shopstyle API 를 이용하여 데이터를 조회하는 기능 및 페이지 개발
- 조회 할 때 DB에 조회한 데이터를 적재하고, 메모리 DB에 그 값을 저장해 놓는 프로세스로, 재조회시(재검색) 빠르게 조회 가능해야함
- 웹서버를 사용하여 하나의 포트에서 프론트와 백엔드를 다룰 수 있어야 함
- 가능한 모든 모듈들을 하나의 MS로 분리시키고 관리할 수 있어야 함

### 목표가 아닌것
- Shopstyle API 의 조회 카테고리는 이전 임의로 조사했었던 데이터로 진행합니다. 반드시 shopstyle의 모든 카테고리를 적용 시킬 필요는 없습니다
- 프론트엔드의 디자인은 생각하지 않습니다
- 데이터의 주기적인 크롤,수집은 생각하지 않음, 이번 프로젝트는 세미나 공부용으로써 MSA에 대해 참고할 수 있게 구조를 짜는게 목적입니다
- 사용자 친화 UI 기획을 하지 않습니다

### 계획
1. 전체 프로세스 및 컨테이너 기획
- MSA 의 장점을 알아보기 위해 기존 모놀리스 형식에서 최대한 Microservice 로 나눕니다. 이번 프로젝트에서 사용하는 container 는 총 6개 입니다. https://github.com/serendipity1004/medium-docker-to-kubernetes 의 깃헙 참조하여 작성하였습니다.

```
nginx (웹서버)
mongodb (DB)
redis (DB, mem)
polling_server (백엔드)
python_server (백엔드)
vue_front (프론트)
```

2. DB 설정
- 데이터베이스를 구축합니다.
    - 크게 2개로 적재용(필요에 따라 조회용)의 MongoDB 와, 오로지 조회용의 Redis로 DB 를 설정합니다.
    ```
    MongoDB
    NoSQL 의 도큐먼트 기반의 DB 입니다. 개발자들에게 익숙한 JSON 형식으로 1개의 도큐먼트로 관리가능합니다.

    Redis
    NoSQL 의 key-value 기반의 DB 입니다. 가장 큰 특징은 메모리 DB 로써, 데이터 입출력이 기존 Disk 기반 DB 보다 빠릅니다. 주로 티켓 예매시의 중복 거래 방지를 위해 빠른 속도가 필요한데 그 때 사용합니다.
    ```

3. 서버 구축
- 서버는 총 2개로 구성합니다.
    - 데이터를 Redis 에서 조회해서 반환해 주는 반응시간을 우선시 하는 기능을 하는 server
    - 데이터가 Redis 에 없을 때 Shopstyle API 를 호출하고 Polling하는 server
- 기본적으로 데이터를 조회하는 것이 목적이기 때문에, 빠른 조회를 위해 기본 서버는 Redis 와 결합합니다.
- 만약 Redis 에 원하는 데이터가 없을 때, Shopstyle API 를 호출하여 polling 하여 데이터를 반환해주는 서버입니다. MongoDB 와 결합하고, polling 값을 Redis 에 저장하여서 다시 데이터를 조회할 때 빠르게 검색할 수 있게 setup 하는 기능을 추가합니다.
- 서버는 언어 python 으로 구축하고, 프레임워크는 비동기 지원이 되는 fastAPI 를 사용합니다. 그외 라이브러리는 requests(polling용), redis, pymongo 를 셋업합니다.

4. 프론트엔드 구축
- 프론트엔드는 VueJS 를 이용합니다. 개발의 속도와, 쉬운 문법으로 선택하였습니다.
- 구축 페이지는 단 1개로, 왼쪽에 사이드바로 카테고리가 나와야하고, 오른편엔 그 결과한 조회값이 나와야합니다.

5. 웹서버 구축
- 사실 그리 필요는 없지만, MSA 의 특징을 확실하게 보기 위해, 일부러 추가 시켰습니다.
- Apache와 nginx 가 있습니다만, C10K(한 시스템에 동시 접속자수가 1만명이 넘어갈때) 문제점을 해결하기 위해 nginx 를 선택하였습니다
```
nginx 
Event-Driven 방식으로 동작합니다. 즉 프로그램 흐름이 이벤트에 의해 결정이 됩니다.
비동기, 효율적 방식으로 task 를 처리합니다. Apache 와 달리 동시접속자수가 많아져도 추가적인 생성비용이 들지 않습니다.
```
6. Dockerizing
- 개발한 환경들을 전부 가상화 시킵니다. DB, redis, mongodb 는 공식 image 를 사용하고 그 외의 컨테이너는 독자적으로 설정값을 넣어 진행합니다.
- 포트 포워딩, 맵핑(도커컨테이너 내부에서 동작하는 서버로 연결해주는 형식)
    - MongoDB 27018 -> 27017
    - Redis 6379 -> 6379
    - python server 5000->3000 (nginx 를 쓰기 때문에 굳이 필요 없습니다)
    - polling server 3000 -> 3000 
    - nginx 8088 -> 80
